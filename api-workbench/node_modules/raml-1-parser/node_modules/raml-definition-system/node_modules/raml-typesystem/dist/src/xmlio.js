"use strict";
/// <reference path="../typings/main.d.ts" />
var xml2js = require("xml2js");
var restrictions_1 = require("./restrictions");
function readObject(content, t) {
    var result = null;
    var opts = {};
    opts.explicitChildren = false;
    opts.explicitArray = false;
    opts.explicitRoot = false;
    xml2js.parseString(content, opts, function (err, res) {
        result = res;
        if (err) {
            throw new Error();
        }
    });
    result = postProcess(result, t);
    return result;
}
exports.readObject = readObject;
function postProcess(result, t) {
    t.meta().forEach(function (x) {
        if (x instanceof restrictions_1.PropertyIs) {
            var pi = x;
            if (pi.value().isNumber()) {
                if (result.hasOwnProperty(pi.propertyName())) {
                    var vl = parseFloat(result[pi.propertyName()]);
                    if (!isNaN(vl)) {
                        result[pi.propertyName()] = vl;
                    }
                }
            }
            if (pi.value().isBoolean()) {
                if (result.hasOwnProperty(pi.propertyName())) {
                    var bvl = result[pi.propertyName()];
                    if (bvl == "true") {
                        result[pi.propertyName()] = true;
                    }
                    if (bvl == "false") {
                        result[pi.propertyName()] = false;
                    }
                }
            }
        }
    });
    return result;
}
//# sourceMappingURL=xmlio.js.map